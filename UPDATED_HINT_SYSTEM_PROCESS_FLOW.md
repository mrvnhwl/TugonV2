# Updated Hint System Process Flow

## Overview

This document explains how the restructured hint system works with curated hints from the `src/components/data/hints` folder.

## Date Updated

October 13, 2025

---

## New Architecture

### **3-Tier Hint System (Updated)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥‡ TIER 1: AI-Generated Templates          â”‚
â”‚  - Generated by Gemini API                  â”‚
â”‚  - 8 behaviors Ã— 3 variations = 24 hints   â”‚
â”‚  - Uses {behavior}, {wrongPart}, {stepLabel}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ âŒ AI service unavailable
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥ˆ TIER 2: Curated Templates (NEW!)        â”‚
â”‚  - Loaded from src/components/data/hints/   â”‚
â”‚  - Converted to template format            â”‚
â”‚  - Uses {behavior}, {wrongPart}, {stepLabel}â”‚
â”‚  - Context-aware and subject-specific       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ âŒ Curated hints fail to load
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥‰ TIER 3: Hardcoded Templates (Last Resort)â”‚
â”‚  - Built into hintGenerator.ts             â”‚
â”‚  - Generic fallback templates              â”‚
â”‚  - Uses {behavior}, {wrongPart}, {stepLabel}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Updated Components

### **1. Enhanced Hint Structure**

**File:** `src/components/data/hints/topic1/category1.ts`

**Before:**

```typescript
genericHint: "ğŸ’¡ Replace x with 8 in the function. Write: f(8) = 2(8) - 7";
signErrorHint: "âš ï¸ Check your signs! Make sure you have 2(8) - 7, not 2(8) + 7";
```

**After:**

```typescript
genericHint: "Hey there, you're {behavior}. Check {wrongPart} in your {stepLabel} - make sure to replace x with 8!";
signErrorHint: "I see you're {behavior}. Focus on {wrongPart} in your {stepLabel} - check those signs carefully!";
```

### **2. New Curated Hint Loader**

**File:** `src/components/tugon/services/curatedHintLoader.ts`

**Purpose:** Converts curated hints to template format

**Key Features:**

- Imports hints from all categories
- Maps behavior types to hint variations
- Extracts templates with placeholders
- Provides fallback templates

### **3. Updated Hint Generator**

**File:** `src/components/tugon/services/hintGenerator.ts`

**Changes:**

- `getFallbackTemplates()` now uses `CuratedHintLoader`
- Fallback hierarchy: Curated â†’ Hardcoded
- Better error handling and logging

---

## Detailed Process Flow

### **Step 1: User Makes Wrong Answer**

```typescript
// UserInput.tsx - handleOnBlur()
const validation = InputValidator.validateStepSimple(
  userInput,
  expectedAnswer,
  stepLabel,
  lineIndex,
  expectedSteps
);
```

### **Step 2: Behavior Analysis & Token Extraction**

```typescript
// UserInput.tsx - showHintMessage()
const analysis = BehaviorAnalyzer.analyze(userInput, correctAnswer, attemptHistory);
const wrongPart = formatWrongTokensForHint(extracted.wrongTokens, ...);
const stepLabel = expectedSteps[lineIndex]?.label || 'this step';
```

### **Step 3: Template Selection (3-Tier)**

#### **ğŸ¥‡ Tier 1: AI Templates**

```typescript
if (behaviorTemplates && behaviorTemplates.templates) {
  const templateObj = behaviorTemplates.templates.find(
    (t) => t.behaviorType === mappedBehavior
  );
  const selectedTemplate = templateObj.templates[randomIndex];
  hint = fillHintTemplate(
    selectedTemplate,
    behaviorDescription,
    wrongPart,
    stepLabel
  );
}
```

#### **ğŸ¥ˆ Tier 2: Curated Templates (NEW!)**

```typescript
// hintGenerator.ts - getFallbackTemplates()
try {
  const { CuratedHintLoader } = require("./curatedHintLoader");
  const curatedTemplates = CuratedHintLoader.convertToTemplateFormat();
  return curatedTemplates; // Uses curated hints from hints folder!
} catch (error) {
  // Fall to Tier 3
}
```

#### **ğŸ¥‰ Tier 3: Hardcoded Templates**

```typescript
// Final fallback - hardcoded in hintGenerator.ts
return {
  templates: [
    { behaviorType: "sign-error", templates: ["Check {wrongPart}..."] },
  ],
};
```

### **Step 4: Template Filling**

```typescript
// UserInput.tsx - fillHintTemplate()
return template
  .replace(/\{behavior\}/g, "confusing plus and minus signs")
  .replace(/\{wrongPart\}/g, "the + sign")
  .replace(/\{stepLabel\}/g, "substitution");
```

**Result:** `"I see you're confusing plus and minus signs. Focus on the + sign in your substitution - check those signs carefully!"`

### **Step 5: Visual Enhancement & Toast Display**

```typescript
// UserInput.tsx - renderEnhancedHint()
return parts.map((part, index) => {
  if (part.match(/^["'].*["']$/)) {
    return <span className="font-bold text-red-600 bg-red-50">{part}</span>;
  }
  if (stepLabel && part.toLowerCase() === stepLabel.toLowerCase()) {
    return (
      <span className="font-semibold text-teal-700 underline">{part}</span>
    );
  }
  return <span>{part}</span>;
});
```

---

## How Curated Hints are Loaded

### **CuratedHintLoader.convertToTemplateFormat()**

1. **Import Registered Hints**

   ```typescript
   static {
     this.registerHints(1, 1, Topic1_Category1_Hints);
     // More categories...
   }
   ```

2. **Extract Templates by Behavior**

   ```typescript
   for (const behaviorType of ['sign-error', 'magnitude-error', ...]) {
     for (const questionHints of categoryHints.questions) {
       for (const stepHint of questionHints.stepHints) {
         const hintText = this.getHintForBehavior(stepHint, behaviorType);
         templateStrings.push(hintText);
       }
     }
   }
   ```

3. **Remove Duplicates & Create Templates**

   ```typescript
   const uniqueTemplates = [...new Set(templateStrings)];
   const selectedTemplates = uniqueTemplates.slice(0, 3);

   templates.push({
     behaviorType: "sign-error",
     templates: selectedTemplates,
   });
   ```

---

## Example Template Conversion

### **Input (from category1.ts):**

```typescript
signErrorHint: "I see you're {behavior}. Focus on {wrongPart} in your {stepLabel} - check those signs carefully!";
```

### **Processing:**

- **Behavior:** `"confusing plus and minus signs"`
- **Wrong Part:** `"the + sign"`
- **Step Label:** `"substitution"`

### **Output (filled template):**

```
"I see you're confusing plus and minus signs. Focus on the + sign in your substitution - check those signs carefully!"
```

### **Visual Result:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ Hey there,                          â”‚
â”‚                                        â”‚
â”‚    I see you're confusing plus and    â”‚
â”‚    minus signs. Focus on the + sign   â”‚
â”‚    in your substitution - check those â”‚
â”‚    signs carefully!                    â”‚
â”‚                                        â”‚
â”‚    [+ sign shown in red background]   â”‚
â”‚    [substitution shown with teal      â”‚
â”‚     underline]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Benefits of New System

### **1. Context-Aware Hints**

- Hints are specific to topic/category/question
- Math educators can craft domain-specific language
- Better alignment with curriculum

### **2. Maintainable Templates**

- Easy to update hints in dedicated files
- Version control for hint improvements
- No code changes needed for hint updates

### **3. Consistent Template Format**

- All tiers use same `{behavior}`, `{wrongPart}`, `{stepLabel}` format
- Uniform visual enhancement across all hints
- Seamless fallback between tiers

### **4. Robust Fallback System**

- AI fails â†’ Use curated hints
- Curated fails â†’ Use hardcoded hints
- System always provides helpful feedback

---

## File Structure

```
src/components/
â”œâ”€â”€ tugon/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ hintGenerator.ts          # AI templates + fallback management
â”‚   â”‚   â””â”€â”€ curatedHintLoader.ts      # NEW: Loads hints from hints folder
â”‚   â””â”€â”€ input-system/
â”‚       â””â”€â”€ UserInput.tsx             # Orchestrates hint display
â””â”€â”€ data/
    â””â”€â”€ hints/
        â”œâ”€â”€ types.ts                  # Type definitions
        â”œâ”€â”€ index.ts                  # Hint registry (old system)
        â””â”€â”€ topic1/
            â””â”€â”€ category1.ts          # UPDATED: Template-based hints
```

---

## Console Output Examples

### **Successful Curated Loading:**

```
ğŸ”§ Loading curated hint templates from hints folder...
âœ… Loaded curated templates: 8 behaviors
ğŸ¥ˆ Using curated template for behavior: sign-error
```

### **Fallback to Hardcoded:**

```
ğŸ”§ Loading curated hint templates from hints folder...
âš ï¸ Failed to load curated templates, using hardcoded fallback: Module not found
ğŸ¥‰ Using hardcoded fallback template
```

---

## Testing the New System

### **1. Verify Curated Hints Load**

```javascript
import { CuratedHintLoader } from "./curatedHintLoader";
const templates = CuratedHintLoader.convertToTemplateFormat();
console.log("Templates:", templates.templates.length); // Should be 8
```

### **2. Test Template Filling**

```javascript
const template =
  "Hey there, you're {behavior}. Check {wrongPart} in your {stepLabel}!";
const filled = fillHintTemplate(
  template,
  "making sign errors",
  "the + sign",
  "substitution"
);
console.log(filled); // "Hey there, you're making sign errors. Check the + sign in your substitution!"
```

### **3. Verify Fallback Chain**

- Disable AI â†’ Should use curated hints
- Break curated loader â†’ Should use hardcoded hints
- All should use template format with placeholders

---

## Future Enhancements

1. **Add More Categories**

   - Create hint files for all topics/categories
   - Register them in CuratedHintLoader

2. **Smart Template Selection**

   - Prefer topic-specific templates over generic ones
   - Weight templates by effectiveness

3. **Template Analytics**

   - Track which templates lead to correct answers
   - A/B test different phrasings

4. **Dynamic Template Generation**
   - Generate templates based on common mistakes
   - Personalize based on student behavior patterns

---

## Migration Checklist

- [x] Update category1.ts hints to template format
- [x] Create CuratedHintLoader service
- [x] Update hintGenerator.ts to use curated hints
- [x] Test template filling and placeholder replacement
- [ ] Add more hint categories
- [ ] Test complete fallback chain
- [ ] Update other category files
- [ ] Performance testing with large hint sets
